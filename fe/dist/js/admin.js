$(document).ready(function(){"use strict";function e(){E=$(".container"),H=$(".description"),P=$(".list-type"),B=H.find(".title"),K=E.find(".layer"),L=H.find(".list-item-area"),NavBar.init(),i(),P.on("click",'input[type="radio"]',i),H.on("click","a.register, a.edit, a.remove",d),K.on("click","a.cancel, a.done",J).on("change",'input[type="file"]',b),V.on("scroll",a)}function n(){return $.when(AdminService.getMetaInfo("conferences"),AdminService.getMetaInfo("tracks"),AdminService.getMetaInfo("speakers")).then(function(e,n,a){W.conferences=e[0].data.map(t),W.tracks=n[0].data.map(t),W.speakers=a[0].data.map(t),console.log(W)})}function t(e){return{text:e.name,value:e.idx}}function a(e){var n=document.body.scrollHeight==document.body.scrollTop+window.innerHeight;n&&X&&!Q&&(G++,X=!1,r(!0))}function i(){R=P.find("input:checked").val(),q=Utils.toFirstUpper(R).slice(0,-1),B.text(q+" list"),G=1,Q=!1,r(),n()}function r(e){return e||(G=1),AdminService.getListOf(R,{page:G}).then(function(n){return o(n,e)},u).always(F)}function o(e,n){console.log(R,e,G,Q);var t=!n&&!e.data.length;return Q=!e.data.length,t?L.html(Template.noItem()):void s(e.data,n)}function s(e,n){"sessions"===R&&e.forEach(function(e){e.timeInfo=Utils.getTimeInfoFromKey(e.time)});var t=f(e);n||L.html(""),L.append(t)}function c(e){return l("form",e||{})}function f(e){return l("item",e)}function l(e,n){var t={};return t[R]=n,Template[e](t)}function u(e){var n=q+" 조회 실패, "+e.responseJSON.message;alert(n)}function d(e){e.preventDefault(),e.stopPropagation();var n=$(e.target);if(n.hasClass("register"))m();else{var t=n.closest("section.item-container").data("id");n.hasClass("edit")?y(t):n.hasClass("remove")&&A(t)}}function m(){v({isRegister:!0})}function v(e){var n=c(e);if("tracks"===R||"sessions"===R){var t=k(R);K.html(n),g(t),p()}else K.html(n);K.slideDown()}function p(){K.find("select").each(function(e,n){var t=$(n),a=t.data("value");t.val(a)})}function g(e){if(e){var n=K.find("form");e.conference&&n.find("#item-id").html(e.conference),e.track&&n.find("#item-track-name").html(e.track),e.speaker&&n.find("#item-speaker-name").html(e.speaker)}}function h(e){return['<option value="',e.value,'">',e.text,"</options>"].join("")}function k(e){var n={};return"tracks"===e?n.conference=W.conferences.map(h).join(""):(n.track=W.tracks.map(h).join(""),n.speaker=W.speakers.map(h).join("")),n}function y(e){if(X)return X=!1,AdminService.get(R,{id:e}).then(S,w).always(F)}function S(e){console.log("detail ",R,e),v(e.data[0])}function w(e){var n=q+" 상세 정보 로딩 실패, "+e.responseJSON.message;alert(n)}function A(e){if(X){var n="관련된 데이터가 전부 삭제될 수 있습니다. 계속 진행하시겠습니까?";if(window.confirm(n))return X=!1,AdminService.delete(R,{id:e}).then(function(n){return N(e)},O).always(F)}}function N(e){alert("삭제 성공!");var n=['section[data-id="',e,'"]'].join("");L.find(n).remove()}function O(e){var n=q+" 삭제 실패, "+e.responseJSON.message;alert(n)}function J(e){e.preventDefault(),e.stopPropagation();var n=$(e.target);n.hasClass("cancel")?T():n.hasClass("create")?x(e):n.hasClass("edit")&&U(e)}function x(e){var n=$(e.target).closest("form"),t=Utils.getFormDataToJSON(n.serializeArray());return AdminService.create(R,t).then(C,I).always(F)}function C(e){var n=q+" 생성 성공!";alert(n),r(),T()}function I(e){var n=q+" 생성 실패, "+e.responseJSON.message;alert(n)}function T(){K.slideUp()}function U(e){if(X){var n=K.find("form"),t=Utils.getFormDataToJSON(n.serializeArray()),a=K.find(".form").data("id");return X=!1,AdminService.update(R,{id:a},t).then(function(e){return j(a,t)},D).always(F)}}function j(e,n){alert("정보 변경 성공!"),r(),T()}function D(e){var n=q+" 정보 변경 실패, "+e.responseJSON.message;alert(n)}function F(){X=!0}function b(e){var n=this.files[0];if(n&&X)return X=!1,FileService.upload(R,n).then(function(n){return M(e,n)},z).always(F)}function M(e,n){var t=$(e.target),a=t.siblings('[type="hidden"]'),i=t.siblings(".text-muted");a.val(n.message);var r=$('<img src="'+n.message+'" width="64px" height="64px" alt="">');i.html(r)}function z(e){var n="파일 업로드 실패, "+e.responseJSON.message;alert(n)}var H,P,B,E,K,L,R,q,G,Q,V=$(window),W=($(document),{conferences:{},tracks:{},speakers:{}}),X=!0;e()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zcmMvanMvYWRtaW4uanMiXSwibmFtZXMiOlsiJCIsImRvY3VtZW50IiwicmVhZHkiLCJpbml0IiwiJGNvbnRhaW5lciIsIiRkZXNjcmlwdGlvbiIsIiRyYWRpb0dyb3VwIiwiJHRpdGxlIiwiZmluZCIsIiRsYXllciIsIiRsaXN0IiwiTmF2QmFyIiwic2VsZWN0VHlwZSIsIm9uIiwiaXRlbUFjdGlvbiIsImxheWVyQWN0aW9uIiwidXBsb2FkRmlsZSIsIiR3aW5kb3ciLCJzY3JvbGxlZFRvQm90dG9tIiwiZ2V0U2VsZWN0T3B0aW9uRGF0YSIsIndoZW4iLCJBZG1pblNlcnZpY2UiLCJnZXRNZXRhSW5mbyIsInRoZW4iLCJjb25mZXJlbmNlcyIsInRyYWNrcyIsInNwZWFrZXJzIiwic2VsZWN0T3B0aW9ucyIsImRhdGEiLCJtYXAiLCJnZXRQYWlyIiwiY29uc29sZSIsImxvZyIsIml0ZW0iLCJ0ZXh0IiwibmFtZSIsInZhbHVlIiwiaWR4IiwiZSIsImlzTmVlZE1vcmVMb2FkaW5nIiwiYm9keSIsInNjcm9sbEhlaWdodCIsInNjcm9sbFRvcCIsIndpbmRvdyIsImlubmVySGVpZ2h0IiwiYWpheERvbmUiLCJpc0VuZCIsInBhZ2UiLCJnZXRMaXN0T2ZUeXBlIiwidHlwZSIsInZhbCIsInR5cGVMYWJlbCIsIlV0aWxzIiwidG9GaXJzdFVwcGVyIiwic2xpY2UiLCJtb3JlTG9hZGluZyIsImdldExpc3RPZiIsInJlcyIsInN1Y2Nlc3NHZXRMaXN0T2ZUeXBlIiwiZmFpbEdldExpc3RPZlR5cGUiLCJhbHdheXMiLCJoYW5kbGVBamF4RG9uZSIsImlzRW1wdHkiLCJsZW5ndGgiLCJodG1sIiwiVGVtcGxhdGUiLCJub0l0ZW0iLCJhcHBlbmREYXRhIiwiZm9yRWFjaCIsInRpbWVJbmZvIiwiZ2V0VGltZUluZm9Gcm9tS2V5IiwidGltZSIsImRvbXMiLCJnZXRJdGVtRnJvbVRlbXBsYXRlIiwiYXBwZW5kIiwiZ2V0Rm9ybUZyb21UZW1wbGF0ZSIsImdldERPTUZyb21UZW1wbGF0ZSIsInRlbXBsYXRlVHlwZSIsIm9iaiIsImVycm9yIiwibWVzc2FnZSIsInJlc3BvbnNlSlNPTiIsImFsZXJ0IiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCIkdGFyZ2V0IiwidGFyZ2V0IiwiaGFzQ2xhc3MiLCJyZWdpc3Rlckl0ZW0iLCJpZCIsImNsb3Nlc3QiLCJlZGl0SXRlbSIsImRlbGV0ZUl0ZW0iLCJvcGVuTGF5ZXIiLCJpc1JlZ2lzdGVyIiwiZm9ybSIsIm9wdGlvbnMiLCJnZXRPcHRpb25ET00iLCJpbnNlcnRPcHRpb25ET00iLCJyZXNvbHZlU2VsZWN0SXRlbSIsInNsaWRlRG93biIsImVhY2giLCJzZWxlY3QiLCJlbGVtIiwic2VsZWN0ZWQiLCIkZm9ybSIsImNvbmZlcmVuY2UiLCJ0cmFjayIsInNwZWFrZXIiLCJvcHRpb25ET00iLCJqb2luIiwiZ2V0Iiwic3VjY2Vzc0dldERldGFpbEl0ZW0iLCJmYWlsR2V0RGV0YWlsSXRlbSIsImNvbmZpcm0iLCJkZWxldGUiLCJzdWNjZXNzRGVsZXRlSXRlbSIsImZhaWxEZWxldGVJdGVtIiwic2VsZWN0b3IiLCJyZW1vdmUiLCJjbG9zZUxheWVyIiwiY3JlYXRlSXRlbSIsImRvbmVFZGl0SXRlbSIsImdldEZvcm1EYXRhVG9KU09OIiwic2VyaWFsaXplQXJyYXkiLCJjcmVhdGUiLCJzdWNjZXNzQ3JlYXRlSXRlbSIsImZhaWxDcmVhdEl0ZW0iLCJzbGlkZVVwIiwidXBkYXRlIiwic3VjY2Vzc0RvbmVFZGl0SXRlbSIsImZhaWxlRG9uZUVkaXRJdGVtIiwiZmlsZSIsInRoaXMiLCJmaWxlcyIsIkZpbGVTZXJ2aWNlIiwidXBsb2FkIiwic3VjY2Vzc1VwbG9hZEZpbGUiLCJmYWlsVXBsb2FkRmlsZSIsIiRoaWRkZW4iLCJzaWJsaW5ncyIsIiR0ZXh0IiwiJGltZyJdLCJtYXBwaW5ncyI6IkFBQUFBLEVBQUVDLFVBQVVDLE1BQU0sV0FDaEIsWUFtQkEsU0FBU0MsS0FDUEMsRUFBYUosRUFBRSxjQUNmSyxFQUFlTCxFQUFFLGdCQUNqQk0sRUFBY04sRUFBRSxjQUNoQk8sRUFBU0YsRUFBYUcsS0FBSyxVQUMzQkMsRUFBU0wsRUFBV0ksS0FBSyxVQUN6QkUsRUFBUUwsRUFBYUcsS0FBSyxtQkFFMUJHLE9BQU9SLE9BQ1BTLElBRUFOLEVBQVlPLEdBQUcsUUFBUyxzQkFBdUJELEdBQy9DUCxFQUFhUSxHQUFHLFFBQVMsK0JBQWdDQyxHQUN6REwsRUFBT0ksR0FBRyxRQUFTLG1CQUFvQkUsR0FDaENGLEdBQUcsU0FBVSxxQkFBc0JHLEdBRTFDQyxFQUFRSixHQUFHLFNBQVVLLEdBR3ZCLFFBQVNDLEtBSVAsTUFBT25CLEdBQUVvQixLQUNQQyxhQUFhQyxZQUFZLGVBQ3pCRCxhQUFhQyxZQUFZLFVBQ3pCRCxhQUFhQyxZQUFZLGFBQ3pCQyxLQUFLLFNBQVVDLEVBQWFDLEVBQVFDLEdBQ3BDQyxFQUFjSCxZQUFjQSxFQUFZLEdBQUdJLEtBQUtDLElBQUlDLEdBQ3BESCxFQUFjRixPQUFTQSxFQUFPLEdBQUdHLEtBQUtDLElBQUlDLEdBQzFDSCxFQUFjRCxTQUFXQSxFQUFTLEdBQUdFLEtBQUtDLElBQUlDLEdBQzlDQyxRQUFRQyxJQUFJTCxLQUloQixRQUFTRyxHQUFTRyxHQUNoQixPQUNFQyxLQUFNRCxFQUFLRSxLQUNYQyxNQUFPSCxFQUFLSSxLQUloQixRQUFTbkIsR0FBa0JvQixHQUl6QixHQUFJQyxHQUFvQnRDLFNBQVN1QyxLQUFLQyxjQUFnQnhDLFNBQVN1QyxLQUFLRSxVQUFZQyxPQUFPQyxXQUVuRkwsSUFBcUJNLElBQWFDLElBQ3BDQyxJQUNBRixHQUFXLEVBQ1hHLEdBQWMsSUFJbEIsUUFBU3BDLEtBQ1BxQyxFQUFPM0MsRUFBWUUsS0FBSyxpQkFBaUIwQyxNQUN6Q0MsRUFBWUMsTUFBTUMsYUFBYUosR0FBTUssTUFBTSxHQUFHLEdBQzlDL0MsRUFBTzJCLEtBQUtpQixFQUFZLFNBQ3hCSixFQUFPLEVBQ1BELEdBQVEsRUFFUkUsSUFDQTdCLElBR0YsUUFBUzZCLEdBQWVPLEdBTXRCLE1BTEtBLEtBQ0hSLEVBQU8sR0FJRjFCLGFBQWFtQyxVQUFVUCxHQUM1QkYsS0FBTUEsSUFDTHhCLEtBQUssU0FBVWtDLEdBQ2hCLE1BQU9DLEdBQXFCRCxFQUFLRixJQUNoQ0ksR0FDQUMsT0FBT0MsR0FJWixRQUFTSCxHQUFzQkQsRUFBS0YsR0FDbEN4QixRQUFRQyxJQUFJaUIsRUFBTVEsRUFBS1YsRUFBTUQsRUFDN0IsSUFBSWdCLElBQVdQLElBQWdCRSxFQUFJN0IsS0FBS21DLE1BR3hDLE9BRkFqQixJQUFTVyxFQUFJN0IsS0FBS21DLE9BRWRELEVBQ0twRCxFQUFNc0QsS0FBS0MsU0FBU0MsY0FHN0JDLEdBQVdWLEVBQUk3QixLQUFNMkIsR0FHdkIsUUFBU1ksR0FBWXZDLEVBQU0yQixHQUNaLGFBQVROLEdBQ0ZyQixFQUFLd0MsUUFBUSxTQUFVbkMsR0FDckJBLEVBQUtvQyxTQUFXakIsTUFBTWtCLG1CQUFtQnJDLEVBQUtzQyxPQU1sRCxJQUFJQyxHQUFPQyxFQUFvQjdDLEVBRTFCMkIsSUFDSDdDLEVBQU1zRCxLQUFLLElBRWJ0RCxFQUFNZ0UsT0FBT0YsR0FHZixRQUFTRyxHQUFxQi9DLEdBQzVCLE1BQU9nRCxHQUFtQixPQUFRaEQsT0FHcEMsUUFBUzZDLEdBQXFCN0MsR0FDNUIsTUFBT2dELEdBQW1CLE9BQVFoRCxHQUdwQyxRQUFTZ0QsR0FBb0JDLEVBQWNqRCxHQUN6QyxHQUFJa0QsS0FFSixPQURBQSxHQUFJN0IsR0FBUXJCLEVBQ0xxQyxTQUFTWSxHQUFjQyxHQUdoQyxRQUFTbkIsR0FBbUJvQixHQUMxQixHQUFJQyxHQUFVN0IsRUFBWSxXQUFhNEIsRUFBTUUsYUFBYUQsT0FDMURFLE9BQU1GLEdBR1IsUUFBU2xFLEdBQVl3QixHQUNuQkEsRUFBRTZDLGlCQUNGN0MsRUFBRThDLGlCQUNGLElBQUlDLEdBQVVyRixFQUFFc0MsRUFBRWdELE9BRWxCLElBQUlELEVBQVFFLFNBQVMsWUFDbkJDLFFBQ0ssQ0FDTCxHQUFJQyxHQUFLSixFQUFRSyxRQUFRLDBCQUEwQjlELEtBQUssS0FDcER5RCxHQUFRRSxTQUFTLFFBQ25CSSxFQUFTRixHQUNBSixFQUFRRSxTQUFTLFdBQzFCSyxFQUFXSCxJQUtqQixRQUFTRCxLQUNQSyxHQUNFQyxZQUFZLElBSWhCLFFBQVNELEdBQVdqRSxHQUNsQixHQUFJbUUsR0FBT3BCLEVBQW9CL0MsRUFFL0IsSUFBYSxXQUFUcUIsR0FBOEIsYUFBVEEsRUFBcUIsQ0FDNUMsR0FBSStDLEdBQVVDLEVBQWFoRCxFQUMzQnhDLEdBQU91RCxLQUFLK0IsR0FDWkcsRUFBZ0JGLEdBQ2hCRyxRQUVBMUYsR0FBT3VELEtBQUsrQixFQUdkdEYsR0FBTzJGLFlBR1QsUUFBU0QsS0FDUDFGLEVBQU9ELEtBQUssVUFDVDZGLEtBQUssU0FBVWhFLEVBQUtpRSxHQUNuQixHQUFJQyxHQUFPdkcsRUFBRXNHLEdBQ1RFLEVBQVdELEVBQUszRSxLQUFLLFFBQ3pCMkUsR0FBS3JELElBQUlzRCxLQUlmLFFBQVNOLEdBQWlCRixHQUN4QixHQUFLQSxFQUFMLENBSUEsR0FBSVMsR0FBUWhHLEVBQU9ELEtBQUssT0FDcEJ3RixHQUFRVSxZQUNWRCxFQUFNakcsS0FBSyxZQUFZd0QsS0FBS2dDLEVBQVFVLFlBRWxDVixFQUFRVyxPQUNWRixFQUFNakcsS0FBSyxvQkFBb0J3RCxLQUFLZ0MsRUFBUVcsT0FFMUNYLEVBQVFZLFNBQ1ZILEVBQU1qRyxLQUFLLHNCQUFzQndELEtBQUtnQyxFQUFRWSxVQUlsRCxRQUFTQyxHQUFXL0IsR0FDbEIsT0FBUSxrQkFBbUJBLEVBQUkxQyxNQUFPLEtBQU0wQyxFQUFJNUMsS0FBTSxjQUFjNEUsS0FBSyxJQUczRSxRQUFTYixHQUFjaEQsR0FDckIsR0FBSXVCLEtBUUosT0FOYSxXQUFUdkIsRUFDRnVCLEVBQUtrQyxXQUFhL0UsRUFBY0gsWUFBWUssSUFBSWdGLEdBQVdDLEtBQUssS0FFaEV0QyxFQUFLbUMsTUFBUWhGLEVBQWNGLE9BQU9JLElBQUlnRixHQUFXQyxLQUFLLElBQ3REdEMsRUFBS29DLFFBQVVqRixFQUFjRCxTQUFTRyxJQUFJZ0YsR0FBV0MsS0FBSyxLQUVyRHRDLEVBR1QsUUFBU21CLEdBQVVGLEdBQ2pCLEdBQUs1QyxFQUtMLE1BREFBLElBQVcsRUFDSnhCLGFBQWEwRixJQUFJOUQsR0FDdEJ3QyxHQUFJQSxJQUNIbEUsS0FBS3lGLEVBQXNCQyxHQUMzQnJELE9BQU9DLEdBR1osUUFBU21ELEdBQXNCdkQsR0FFN0IxQixRQUFRQyxJQUFJLFVBQVdpQixFQUFNUSxHQUM3Qm9DLEVBQVVwQyxFQUFJN0IsS0FBSyxJQUdyQixRQUFTcUYsR0FBbUJsQyxHQUMxQixHQUFJQyxHQUFVN0IsRUFBWSxpQkFBbUI0QixFQUFNRSxhQUFhRCxPQUNoRUUsT0FBTUYsR0FHUixRQUFTWSxHQUFZSCxHQUNuQixHQUFLNUMsRUFBTCxDQUlBLEdBQUltQyxHQUFVLHNDQUNkLElBQUtyQyxPQUFPdUUsUUFBUWxDLEdBSXBCLE1BREFuQyxJQUFXLEVBQ0p4QixhQUFhOEYsT0FBT2xFLEdBQ3pCd0MsR0FBSUEsSUFDSGxFLEtBQUssU0FBVWtDLEdBQ2hCLE1BQU8yRCxHQUFrQjNCLElBQ3hCNEIsR0FDQXpELE9BQU9DLElBR1osUUFBU3VELEdBQW1CM0IsR0FDMUJQLE1BQU0sU0FHTixJQUFJb0MsSUFBWSxvQkFBcUI3QixFQUFJLE1BQU1xQixLQUFLLEdBQ3BEcEcsR0FBTUYsS0FBSzhHLEdBQVVDLFNBR3ZCLFFBQVNGLEdBQWdCdEMsR0FDdkIsR0FBSUMsR0FBVTdCLEVBQVksV0FBYTRCLEVBQU1FLGFBQWFELE9BQzFERSxPQUFNRixHQUdSLFFBQVNqRSxHQUFhdUIsR0FDcEJBLEVBQUU2QyxpQkFDRjdDLEVBQUU4QyxpQkFFRixJQUFJQyxHQUFVckYsRUFBRXNDLEVBQUVnRCxPQUVkRCxHQUFRRSxTQUFTLFVBQ25CaUMsSUFDU25DLEVBQVFFLFNBQVMsVUFDMUJrQyxFQUFXbkYsR0FDRitDLEVBQVFFLFNBQVMsU0FDMUJtQyxFQUFhcEYsR0FJakIsUUFBU21GLEdBQVluRixHQUNuQixHQUFJbUUsR0FBUXpHLEVBQUVzQyxFQUFFZ0QsUUFBUUksUUFBUSxRQUM1QjlELEVBQU93QixNQUFNdUUsa0JBQWtCbEIsRUFBTW1CLGlCQUV6QyxPQUFPdkcsY0FBYXdHLE9BQU81RSxFQUFNckIsR0FDOUJMLEtBQUt1RyxFQUFtQkMsR0FDeEJuRSxPQUFPQyxHQUdaLFFBQVNpRSxHQUFtQnJFLEdBQzFCLEdBQUl1QixHQUFVN0IsRUFBWSxTQUMxQitCLE9BQU1GLEdBRU5oQyxJQUNBd0UsSUFHRixRQUFTTyxHQUFlaEQsR0FDdEIsR0FBSUMsR0FBVTdCLEVBQVksV0FBYTRCLEVBQU1FLGFBQWFELE9BQzFERSxPQUFNRixHQUdSLFFBQVN3QyxLQUNQL0csRUFBT3VILFVBR1QsUUFBU04sR0FBY3BGLEdBQ3JCLEdBQUtPLEVBQUwsQ0FHQSxHQUFJNEQsR0FBUWhHLEVBQU9ELEtBQUssUUFDcEJvQixFQUFPd0IsTUFBTXVFLGtCQUFrQmxCLEVBQU1tQixrQkFDckNuQyxFQUFLaEYsRUFBT0QsS0FBSyxTQUFTb0IsS0FBSyxLQUduQyxPQUZBaUIsSUFBVyxFQUVKeEIsYUFBYTRHLE9BQU9oRixHQUN6QndDLEdBQUlBLEdBQ0g3RCxHQUFNTCxLQUFLLFNBQVVrQyxHQUN0QixNQUFPeUUsR0FBb0J6QyxFQUFJN0QsSUFDOUJ1RyxHQUNBdkUsT0FBT0MsSUFHWixRQUFTcUUsR0FBcUJ6QyxFQUFJN0QsR0FDaENzRCxNQUFNLGFBRU5sQyxJQUNBd0UsSUFHRixRQUFTVyxHQUFtQnBELEdBQzFCLEdBQUlDLEdBQVU3QixFQUFZLGNBQWdCNEIsRUFBTUUsYUFBYUQsT0FDN0RFLE9BQU1GLEdBR1IsUUFBU25CLEtBQ1BoQixHQUFXLEVBR2IsUUFBUzdCLEdBQVlzQixHQUNuQixHQUFJOEYsR0FBT0MsS0FBS0MsTUFBTSxFQUN0QixJQUFLRixHQUFTdkYsRUFLZCxNQURBQSxJQUFXLEVBQ0owRixZQUFZQyxPQUFPdkYsRUFBTW1GLEdBQzdCN0csS0FBSyxTQUFVa0MsR0FDZCxNQUFPZ0YsR0FBa0JuRyxFQUFHbUIsSUFDM0JpRixHQUNGOUUsT0FBT0MsR0FHWixRQUFTNEUsR0FBbUJuRyxFQUFHbUIsR0FDN0IsR0FBSTRCLEdBQVVyRixFQUFFc0MsRUFBRWdELFFBQ2RxRCxFQUFVdEQsRUFBUXVELFNBQVMsbUJBQzNCQyxFQUFReEQsRUFBUXVELFNBQVMsY0FDN0JELEdBQVF6RixJQUFJTyxFQUFJdUIsUUFDaEIsSUFBSThELEdBQU85SSxFQUFFLGFBQWV5RCxFQUFJdUIsUUFBVSx1Q0FDMUM2RCxHQUFNN0UsS0FBSzhFLEdBR2IsUUFBU0osR0FBZ0IzRCxHQUN2QixHQUFJQyxHQUFVLGNBQWdCRCxFQUFNRSxhQUFhRCxPQUNqREUsT0FBTUYsR0EzWFIsR0FDSTNFLEdBQWNDLEVBQWFDLEVBQVFILEVBQ25DSyxFQUFRQyxFQUNSdUMsRUFBTUUsRUFBV0osRUFBTUQsRUFIdkI3QixFQUFVakIsRUFBRTJDLFFBTVpoQixHQU5pQzNCLEVBQUVDLFdBT3JDdUIsZUFDQUMsVUFDQUMsY0FNRW1CLEdBQVcsQ0ErV2YxQyIsImZpbGUiOiJhZG1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciAkd2luZG93ID0gJCh3aW5kb3cpLCAkZG9jdW1lbnQgPSAkKGRvY3VtZW50KTtcbiAgdmFyICRkZXNjcmlwdGlvbiwgJHJhZGlvR3JvdXAsICR0aXRsZSwgJGNvbnRhaW5lcjtcbiAgdmFyICRsYXllciwgJGxpc3Q7XG4gIHZhciB0eXBlLCB0eXBlTGFiZWwsIHBhZ2UsIGlzRW5kO1xuXG4gIC8vIFRPRE86IOuwnO2RnOulvCDsnITtlZwg7J6E7IucIHNlbGVjdCBvcHRpb24g642w7J207YSwXG4gIHZhciBzZWxlY3RPcHRpb25zID0ge1xuICAgIGNvbmZlcmVuY2VzOiB7fSxcbiAgICB0cmFja3M6IHt9LFxuICAgIHNwZWFrZXJzOiB7fVxuICB9O1xuXG4gIC8vIGFqYXhEb25lIOyDge2DnOuKlCBhamF4IOyalOyyreydtCDrgZ3rgqzripTsp4Ag7IOB7YOc66W8IOygnOyWtO2VmOuKlCDrs4DsiJjqsIBcbiAgLy8gUE9TVCwgUFVULCBERUxFVEUg6rCZ7J2AIOqyveyasCwg7JqU7LKt7J20IOuBneuCmOq4sCDsoITsl5Ag64uk7IucIO2YuOy2nOuQmOuptCDrrLjsoJzqsIAg67Cc7IOd7ZWY6riwIOuVjOusuOyXkFxuICAvLyDtlbTri7kg7JqU7LKt7J20IOuwnOyDne2XgOydhCDrlYwsIGFqYXhEb25lIOydtCBmYWxzZSDrnbzrqbQg7IOI66GcIOyalOyyreydhCDrgqDrpqzsp4Ag7JWK64qU64ukLlxuICB2YXIgYWpheERvbmUgPSB0cnVlO1xuXG4gIGZ1bmN0aW9uIGluaXQgKCkge1xuICAgICRjb250YWluZXIgPSAkKCcuY29udGFpbmVyJyk7XG4gICAgJGRlc2NyaXB0aW9uID0gJCgnLmRlc2NyaXB0aW9uJyk7XG4gICAgJHJhZGlvR3JvdXAgPSAkKCcubGlzdC10eXBlJyk7XG4gICAgJHRpdGxlID0gJGRlc2NyaXB0aW9uLmZpbmQoJy50aXRsZScpO1xuICAgICRsYXllciA9ICRjb250YWluZXIuZmluZCgnLmxheWVyJyk7XG4gICAgJGxpc3QgPSAkZGVzY3JpcHRpb24uZmluZCgnLmxpc3QtaXRlbS1hcmVhJyk7XG5cbiAgICBOYXZCYXIuaW5pdCgpO1xuICAgIHNlbGVjdFR5cGUoKTtcblxuICAgICRyYWRpb0dyb3VwLm9uKCdjbGljaycsICdpbnB1dFt0eXBlPVwicmFkaW9cIl0nLCBzZWxlY3RUeXBlKTtcbiAgICAkZGVzY3JpcHRpb24ub24oJ2NsaWNrJywgJ2EucmVnaXN0ZXIsIGEuZWRpdCwgYS5yZW1vdmUnLCBpdGVtQWN0aW9uKTtcbiAgICAkbGF5ZXIub24oJ2NsaWNrJywgJ2EuY2FuY2VsLCBhLmRvbmUnLCBsYXllckFjdGlvbilcbiAgICAgICAgICAub24oJ2NoYW5nZScsICdpbnB1dFt0eXBlPVwiZmlsZVwiXScsIHVwbG9hZEZpbGUpO1xuXG4gICAgJHdpbmRvdy5vbignc2Nyb2xsJywgc2Nyb2xsZWRUb0JvdHRvbSk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTZWxlY3RPcHRpb25EYXRhICgpIHtcbiAgICAvLyAxLiDsu6jtjbzrn7DsiqQg66as7Iqk7Yq4IOuwm+yVhOyYpOq4sFxuICAgIC8vIDIuIO2KuOuemSDrpqzsiqTtirgg67Cb7JWE7Jik6riwXG4gICAgLy8gMy4g67Cc7ZGc7J6QIOumrOyKpO2KuCDrsJvslYTsmKTquLBcbiAgICByZXR1cm4gJC53aGVuKFxuICAgICAgQWRtaW5TZXJ2aWNlLmdldE1ldGFJbmZvKCdjb25mZXJlbmNlcycpLFxuICAgICAgQWRtaW5TZXJ2aWNlLmdldE1ldGFJbmZvKCd0cmFja3MnKSxcbiAgICAgIEFkbWluU2VydmljZS5nZXRNZXRhSW5mbygnc3BlYWtlcnMnKVxuICAgICkudGhlbihmdW5jdGlvbiAoY29uZmVyZW5jZXMsIHRyYWNrcywgc3BlYWtlcnMpIHtcbiAgICAgIHNlbGVjdE9wdGlvbnMuY29uZmVyZW5jZXMgPSBjb25mZXJlbmNlc1swXS5kYXRhLm1hcChnZXRQYWlyKTtcbiAgICAgIHNlbGVjdE9wdGlvbnMudHJhY2tzID0gdHJhY2tzWzBdLmRhdGEubWFwKGdldFBhaXIpO1xuICAgICAgc2VsZWN0T3B0aW9ucy5zcGVha2VycyA9IHNwZWFrZXJzWzBdLmRhdGEubWFwKGdldFBhaXIpO1xuICAgICAgY29uc29sZS5sb2coc2VsZWN0T3B0aW9ucyk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRQYWlyIChpdGVtKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRleHQ6IGl0ZW0ubmFtZSxcbiAgICAgIHZhbHVlOiBpdGVtLmlkeFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBzY3JvbGxlZFRvQm90dG9tIChlKSB7XG4gICAgLy8g7ZiE7J6sIOyKpO2BrOuhpCDsnITsuZjrpbwg7YyM7JWFIO2bhCxcbiAgICAvLyBjb250YWluZXIg7JmAIOu5hOq1kO2VtOyEnCBib3R0b20g7Jy866Gc67aA7YSwICMgcHgg7J2064K0IOuylOychCDslYjsl5Ag7J6I7J2EIOuVjFxuICAgIC8vIOuLpOydjCDtjpjsnbTsp4Drpbwg67aI65+s7Ji0XG4gICAgdmFyIGlzTmVlZE1vcmVMb2FkaW5nID0gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQgPT0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgKyB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICBpZiAoaXNOZWVkTW9yZUxvYWRpbmcgJiYgYWpheERvbmUgJiYgIWlzRW5kKSB7XG4gICAgICBwYWdlKys7XG4gICAgICBhamF4RG9uZSA9IGZhbHNlO1xuICAgICAgZ2V0TGlzdE9mVHlwZSh0cnVlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZWxlY3RUeXBlICgpIHtcbiAgICB0eXBlID0gJHJhZGlvR3JvdXAuZmluZCgnaW5wdXQ6Y2hlY2tlZCcpLnZhbCgpO1xuICAgIHR5cGVMYWJlbCA9IFV0aWxzLnRvRmlyc3RVcHBlcih0eXBlKS5zbGljZSgwLCAtMSk7XG4gICAgJHRpdGxlLnRleHQodHlwZUxhYmVsICsgJyBsaXN0Jyk7XG4gICAgcGFnZSA9IDE7XG4gICAgaXNFbmQgPSBmYWxzZTtcblxuICAgIGdldExpc3RPZlR5cGUoKTtcbiAgICBnZXRTZWxlY3RPcHRpb25EYXRhKCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRMaXN0T2ZUeXBlIChtb3JlTG9hZGluZykge1xuICAgIGlmICghbW9yZUxvYWRpbmcpIHtcbiAgICAgIHBhZ2UgPSAxO1xuICAgIH1cbiAgICAvLyDsl6zquLDshJzripQgYWpheCByZXF1ZXN0IGRvbmUgaGFuZGxpbmcg7J2EIO2VoCDtlYTsmpTqsIAg7JeG7Ja07IScIOygnOqxsO2VqFxuICAgIC8vIEdFVCDsmpTssq3snYAgc2FmZSwgaWRlbXBvdGVudCDtlZjquLAg65WM66y47J2064ukLlxuICAgIHJldHVybiBBZG1pblNlcnZpY2UuZ2V0TGlzdE9mKHR5cGUsIHtcbiAgICAgIHBhZ2U6IHBhZ2VcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgIHJldHVybiBzdWNjZXNzR2V0TGlzdE9mVHlwZShyZXMsIG1vcmVMb2FkaW5nKTtcbiAgICB9LCBmYWlsR2V0TGlzdE9mVHlwZSlcbiAgICAgIC5hbHdheXMoaGFuZGxlQWpheERvbmUpO1xuICB9XG5cbiAgLy8g7ZiE7J6sIGl0ZW0g7J20IOyVhOuLiOqyg+uPhCDsl4bsnYQg65WMLCBub0l0ZW0g7YWc7ZSM66a/IOuztOyXrOykjFxuICBmdW5jdGlvbiBzdWNjZXNzR2V0TGlzdE9mVHlwZSAocmVzLCBtb3JlTG9hZGluZykge1xuICAgIGNvbnNvbGUubG9nKHR5cGUsIHJlcywgcGFnZSwgaXNFbmQpO1xuICAgIHZhciBpc0VtcHR5ID0gIW1vcmVMb2FkaW5nICYmICFyZXMuZGF0YS5sZW5ndGg7XG4gICAgaXNFbmQgPSAhcmVzLmRhdGEubGVuZ3RoO1xuXG4gICAgaWYgKGlzRW1wdHkpIHtcbiAgICAgIHJldHVybiAkbGlzdC5odG1sKFRlbXBsYXRlLm5vSXRlbSgpKTtcbiAgICB9XG5cbiAgICBhcHBlbmREYXRhKHJlcy5kYXRhLCBtb3JlTG9hZGluZyk7XG4gIH1cblxuICBmdW5jdGlvbiBhcHBlbmREYXRhIChkYXRhLCBtb3JlTG9hZGluZykge1xuICAgIGlmICh0eXBlID09PSBcInNlc3Npb25zXCIpIHtcbiAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICBpdGVtLnRpbWVJbmZvID0gVXRpbHMuZ2V0VGltZUluZm9Gcm9tS2V5KGl0ZW0udGltZSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gc3RlcCAxOiBkYXRhIOulvCBpdGVtIHRlbXBsYXRlIOyXkCDrhKPslrTshJwgRE9NIOyDneyEsVxuICAgIC8vIHN0ZXAgMjog7IOd7ISx7ZWcIERPTSDsnYQgJGxpc3Qg7JeQIOuEo+q4sCAoRE9NIFRyZWUg7IK97J6FKVxuICAgIC8vICAgLSBzdGVwIDIuMTogbW9yZUxvYWRpbmcg7J20IGZhbHNlIOudvOuptCDquLDsobQgJGxpc3Qg64qUIOy0iOq4sO2ZlFxuICAgIHZhciBkb21zID0gZ2V0SXRlbUZyb21UZW1wbGF0ZShkYXRhKTtcblxuICAgIGlmICghbW9yZUxvYWRpbmcpIHtcbiAgICAgICRsaXN0Lmh0bWwoJycpO1xuICAgIH1cbiAgICAkbGlzdC5hcHBlbmQoZG9tcyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGb3JtRnJvbVRlbXBsYXRlIChkYXRhKSB7XG4gICAgcmV0dXJuIGdldERPTUZyb21UZW1wbGF0ZSgnZm9ybScsIGRhdGEgfHwge30pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0SXRlbUZyb21UZW1wbGF0ZSAoZGF0YSkge1xuICAgIHJldHVybiBnZXRET01Gcm9tVGVtcGxhdGUoJ2l0ZW0nLCBkYXRhKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldERPTUZyb21UZW1wbGF0ZSAodGVtcGxhdGVUeXBlLCBkYXRhKSB7XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIG9ialt0eXBlXSA9IGRhdGE7XG4gICAgcmV0dXJuIFRlbXBsYXRlW3RlbXBsYXRlVHlwZV0ob2JqKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZhaWxHZXRMaXN0T2ZUeXBlIChlcnJvcikge1xuICAgIHZhciBtZXNzYWdlID0gdHlwZUxhYmVsICsgJyDsobDtmowg7Iuk7YyoLCAnICsgZXJyb3IucmVzcG9uc2VKU09OLm1lc3NhZ2U7XG4gICAgYWxlcnQobWVzc2FnZSk7XG4gIH1cblxuICBmdW5jdGlvbiBpdGVtQWN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdmFyICR0YXJnZXQgPSAkKGUudGFyZ2V0KTtcblxuICAgIGlmICgkdGFyZ2V0Lmhhc0NsYXNzKCdyZWdpc3RlcicpKSB7XG4gICAgICByZWdpc3Rlckl0ZW0oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGlkID0gJHRhcmdldC5jbG9zZXN0KCdzZWN0aW9uLml0ZW0tY29udGFpbmVyJykuZGF0YSgnaWQnKTtcbiAgICAgIGlmICgkdGFyZ2V0Lmhhc0NsYXNzKCdlZGl0JykpIHtcbiAgICAgICAgZWRpdEl0ZW0oaWQpO1xuICAgICAgfSBlbHNlIGlmICgkdGFyZ2V0Lmhhc0NsYXNzKCdyZW1vdmUnKSkge1xuICAgICAgICBkZWxldGVJdGVtKGlkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiByZWdpc3Rlckl0ZW0gKCkge1xuICAgIG9wZW5MYXllcih7XG4gICAgICBpc1JlZ2lzdGVyOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBvcGVuTGF5ZXIgKGRhdGEpIHtcbiAgICB2YXIgZm9ybSA9IGdldEZvcm1Gcm9tVGVtcGxhdGUoZGF0YSk7XG4gICAgLy8gdHlwZSDsl5Ag65Sw6528IOuPmeyggeycvOuhnCDroZzrlKntlbTslbwg7ZWY64qUIHNlbGVjdCBvcHRpb24g7KCV67O0IOuEo+yWtOyjvOq4sFxuICAgIGlmICh0eXBlID09PSAndHJhY2tzJyB8fCB0eXBlID09PSAnc2Vzc2lvbnMnKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IGdldE9wdGlvbkRPTSh0eXBlKTtcbiAgICAgICRsYXllci5odG1sKGZvcm0pO1xuICAgICAgaW5zZXJ0T3B0aW9uRE9NKG9wdGlvbnMpO1xuICAgICAgcmVzb2x2ZVNlbGVjdEl0ZW0oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGxheWVyLmh0bWwoZm9ybSk7XG4gICAgfVxuXG4gICAgJGxheWVyLnNsaWRlRG93bigpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzb2x2ZVNlbGVjdEl0ZW0gKCkge1xuICAgICRsYXllci5maW5kKCdzZWxlY3QnKVxuICAgICAgLmVhY2goZnVuY3Rpb24gKGlkeCwgc2VsZWN0KSB7XG4gICAgICAgIHZhciBlbGVtID0gJChzZWxlY3QpO1xuICAgICAgICB2YXIgc2VsZWN0ZWQgPSBlbGVtLmRhdGEoJ3ZhbHVlJyk7XG4gICAgICAgIGVsZW0udmFsKHNlbGVjdGVkKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5zZXJ0T3B0aW9uRE9NIChvcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyICRmb3JtID0gJGxheWVyLmZpbmQoJ2Zvcm0nKTtcbiAgICBpZiAob3B0aW9ucy5jb25mZXJlbmNlKSB7XG4gICAgICAkZm9ybS5maW5kKCcjaXRlbS1pZCcpLmh0bWwob3B0aW9ucy5jb25mZXJlbmNlKTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMudHJhY2spIHtcbiAgICAgICRmb3JtLmZpbmQoJyNpdGVtLXRyYWNrLW5hbWUnKS5odG1sKG9wdGlvbnMudHJhY2spO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5zcGVha2VyKSB7XG4gICAgICAkZm9ybS5maW5kKCcjaXRlbS1zcGVha2VyLW5hbWUnKS5odG1sKG9wdGlvbnMuc3BlYWtlcilcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvcHRpb25ET00gKG9iaikge1xuICAgIHJldHVybiBbJzxvcHRpb24gdmFsdWU9XCInLCBvYmoudmFsdWUsICdcIj4nLCBvYmoudGV4dCwgJzwvb3B0aW9ucz4nXS5qb2luKCcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE9wdGlvbkRPTSAodHlwZSkge1xuICAgIHZhciBkb21zID0ge307XG5cbiAgICBpZiAodHlwZSA9PT0gJ3RyYWNrcycpIHtcbiAgICAgIGRvbXMuY29uZmVyZW5jZSA9IHNlbGVjdE9wdGlvbnMuY29uZmVyZW5jZXMubWFwKG9wdGlvbkRPTSkuam9pbignJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvbXMudHJhY2sgPSBzZWxlY3RPcHRpb25zLnRyYWNrcy5tYXAob3B0aW9uRE9NKS5qb2luKCcnKTtcbiAgICAgIGRvbXMuc3BlYWtlciA9IHNlbGVjdE9wdGlvbnMuc3BlYWtlcnMubWFwKG9wdGlvbkRPTSkuam9pbignJyk7XG4gICAgfVxuICAgIHJldHVybiBkb21zO1xuICB9XG5cbiAgZnVuY3Rpb24gZWRpdEl0ZW0gKGlkKSB7XG4gICAgaWYgKCFhamF4RG9uZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGFqYXhEb25lID0gZmFsc2U7XG4gICAgcmV0dXJuIEFkbWluU2VydmljZS5nZXQodHlwZSwge1xuICAgICAgaWQ6IGlkXG4gICAgfSkudGhlbihzdWNjZXNzR2V0RGV0YWlsSXRlbSwgZmFpbEdldERldGFpbEl0ZW0pXG4gICAgICAuYWx3YXlzKGhhbmRsZUFqYXhEb25lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN1Y2Nlc3NHZXREZXRhaWxJdGVtIChyZXMpIHtcbiAgICAvLyDshJzrsoTsl5DshJwg67Cb7JWE7JioIOyDgeyEuCDsoJXrs7QsIGh0bWwg7JeQIOyCveyehVxuICAgIGNvbnNvbGUubG9nKCdkZXRhaWwgJywgdHlwZSwgcmVzKTtcbiAgICBvcGVuTGF5ZXIocmVzLmRhdGFbMF0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZmFpbEdldERldGFpbEl0ZW0gKGVycm9yKSB7XG4gICAgdmFyIG1lc3NhZ2UgPSB0eXBlTGFiZWwgKyAnIOyDgeyEuCDsoJXrs7Qg66Gc65SpIOyLpO2MqCwgJyArIGVycm9yLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xuICAgIGFsZXJ0KG1lc3NhZ2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gZGVsZXRlSXRlbSAoaWQpIHtcbiAgICBpZiAoIWFqYXhEb25lKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIG1lc3NhZ2UgPSAn6rSA66Co65CcIOuNsOydtO2EsOqwgCDsoITrtoAg7IKt7KCc65CgIOyImCDsnojsirXri4jri6QuIOqzhOyGjSDsp4TtlontlZjsi5zqsqDsirXri4jquYw/JztcbiAgICBpZiAoIXdpbmRvdy5jb25maXJtKG1lc3NhZ2UpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGFqYXhEb25lID0gZmFsc2U7XG4gICAgcmV0dXJuIEFkbWluU2VydmljZS5kZWxldGUodHlwZSwge1xuICAgICAgaWQ6IGlkXG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICByZXR1cm4gc3VjY2Vzc0RlbGV0ZUl0ZW0oaWQpO1xuICAgIH0sIGZhaWxEZWxldGVJdGVtKVxuICAgICAgLmFsd2F5cyhoYW5kbGVBamF4RG9uZSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdWNjZXNzRGVsZXRlSXRlbSAoaWQpIHtcbiAgICBhbGVydCgn7IKt7KCcIOyEseqztSEnKTtcbiAgICAvLyDsgq3soJwg7ISx6rO17ZWY66m0LCDrpqzsiqTtirjsl5DshJwg7ZW064u5IOyVhOydtO2FnOydhCDsp4Dsm4zspIxcbiAgICAvLyBleCkgc2VjdGlvbltkYXRhLWlkPVwiMTJcIl1cbiAgICB2YXIgc2VsZWN0b3IgPSBbJ3NlY3Rpb25bZGF0YS1pZD1cIicsIGlkLCAnXCJdJ10uam9pbignJyk7XG4gICAgJGxpc3QuZmluZChzZWxlY3RvcikucmVtb3ZlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBmYWlsRGVsZXRlSXRlbSAoZXJyb3IpIHtcbiAgICB2YXIgbWVzc2FnZSA9IHR5cGVMYWJlbCArICcg7IKt7KCcIOyLpO2MqCwgJyArIGVycm9yLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xuICAgIGFsZXJ0KG1lc3NhZ2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gbGF5ZXJBY3Rpb24gKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIHZhciAkdGFyZ2V0ID0gJChlLnRhcmdldCk7XG5cbiAgICBpZiAoJHRhcmdldC5oYXNDbGFzcygnY2FuY2VsJykpIHtcbiAgICAgIGNsb3NlTGF5ZXIoKTtcbiAgICB9IGVsc2UgaWYgKCR0YXJnZXQuaGFzQ2xhc3MoJ2NyZWF0ZScpKSB7XG4gICAgICBjcmVhdGVJdGVtKGUpO1xuICAgIH0gZWxzZSBpZiAoJHRhcmdldC5oYXNDbGFzcygnZWRpdCcpKSB7XG4gICAgICBkb25lRWRpdEl0ZW0oZSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlSXRlbSAoZSkge1xuICAgIHZhciAkZm9ybSA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ2Zvcm0nKTtcbiAgICB2YXIgZGF0YSA9IFV0aWxzLmdldEZvcm1EYXRhVG9KU09OKCRmb3JtLnNlcmlhbGl6ZUFycmF5KCkpO1xuXG4gICAgcmV0dXJuIEFkbWluU2VydmljZS5jcmVhdGUodHlwZSwgZGF0YSlcbiAgICAgIC50aGVuKHN1Y2Nlc3NDcmVhdGVJdGVtLCBmYWlsQ3JlYXRJdGVtKVxuICAgICAgLmFsd2F5cyhoYW5kbGVBamF4RG9uZSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdWNjZXNzQ3JlYXRlSXRlbSAocmVzKSB7XG4gICAgdmFyIG1lc3NhZ2UgPSB0eXBlTGFiZWwgKyAnIOyDneyEsSDshLHqs7UhJztcbiAgICBhbGVydChtZXNzYWdlKTtcbiAgICAvLyDsg4jroZwg7IOd7ISx7ZWcIOyVhOydtO2FnCDrqqnroZ0g67O07Jes7KO86riwIOychO2VtCDrqqnroZ0gcmVsb2FkaW5nXG4gICAgZ2V0TGlzdE9mVHlwZSgpO1xuICAgIGNsb3NlTGF5ZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZhaWxDcmVhdEl0ZW0gKGVycm9yKSB7XG4gICAgdmFyIG1lc3NhZ2UgPSB0eXBlTGFiZWwgKyAnIOyDneyEsSDsi6TtjKgsICcgKyBlcnJvci5yZXNwb25zZUpTT04ubWVzc2FnZTtcbiAgICBhbGVydChtZXNzYWdlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlTGF5ZXIgKCkge1xuICAgICRsYXllci5zbGlkZVVwKCk7XG4gIH1cblxuICBmdW5jdGlvbiBkb25lRWRpdEl0ZW0gKGUpIHtcbiAgICBpZiAoIWFqYXhEb25lKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciAkZm9ybSA9ICRsYXllci5maW5kKCdmb3JtJyk7XG4gICAgdmFyIGRhdGEgPSBVdGlscy5nZXRGb3JtRGF0YVRvSlNPTigkZm9ybS5zZXJpYWxpemVBcnJheSgpKTtcbiAgICB2YXIgaWQgPSAkbGF5ZXIuZmluZCgnLmZvcm0nKS5kYXRhKCdpZCcpO1xuICAgIGFqYXhEb25lID0gZmFsc2U7XG5cbiAgICByZXR1cm4gQWRtaW5TZXJ2aWNlLnVwZGF0ZSh0eXBlLCB7XG4gICAgICBpZDogaWRcbiAgICB9LCBkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgIHJldHVybiBzdWNjZXNzRG9uZUVkaXRJdGVtKGlkLCBkYXRhKTtcbiAgICB9LCBmYWlsZURvbmVFZGl0SXRlbSlcbiAgICAgIC5hbHdheXMoaGFuZGxlQWpheERvbmUpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3VjY2Vzc0RvbmVFZGl0SXRlbSAoaWQsIGRhdGEpIHtcbiAgICBhbGVydCgn7KCV67O0IOuzgOqyvSDshLHqs7UhJyk7XG4gICAgLy8g7JeF642w7J207Yq4IO2VnCDslYTsnbTthZzsnYQg67O07Jes7KO86riwIOychO2VtCDrqqnroZ0gcmVsb2FkaW5nXG4gICAgZ2V0TGlzdE9mVHlwZSgpO1xuICAgIGNsb3NlTGF5ZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZhaWxlRG9uZUVkaXRJdGVtIChlcnJvcikge1xuICAgIHZhciBtZXNzYWdlID0gdHlwZUxhYmVsICsgJyDsoJXrs7Qg67OA6rK9IOyLpO2MqCwgJyArIGVycm9yLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xuICAgIGFsZXJ0KG1lc3NhZ2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlQWpheERvbmUgKCkge1xuICAgIGFqYXhEb25lID0gdHJ1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwbG9hZEZpbGUgKGUpIHtcbiAgICB2YXIgZmlsZSA9IHRoaXMuZmlsZXNbMF07XG4gICAgaWYgKCFmaWxlIHx8ICFhamF4RG9uZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGFqYXhEb25lID0gZmFsc2U7XG4gICAgcmV0dXJuIEZpbGVTZXJ2aWNlLnVwbG9hZCh0eXBlLCBmaWxlKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICByZXR1cm4gc3VjY2Vzc1VwbG9hZEZpbGUoZSwgcmVzKTtcbiAgICAgIH0sIGZhaWxVcGxvYWRGaWxlKVxuICAgICAgLmFsd2F5cyhoYW5kbGVBamF4RG9uZSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdWNjZXNzVXBsb2FkRmlsZSAoZSwgcmVzKSB7XG4gICAgdmFyICR0YXJnZXQgPSAkKGUudGFyZ2V0KTtcbiAgICB2YXIgJGhpZGRlbiA9ICR0YXJnZXQuc2libGluZ3MoJ1t0eXBlPVwiaGlkZGVuXCJdJyk7XG4gICAgdmFyICR0ZXh0ID0gJHRhcmdldC5zaWJsaW5ncygnLnRleHQtbXV0ZWQnKTtcbiAgICAkaGlkZGVuLnZhbChyZXMubWVzc2FnZSk7XG4gICAgdmFyICRpbWcgPSAkKCc8aW1nIHNyYz1cIicgKyByZXMubWVzc2FnZSArICdcIiB3aWR0aD1cIjY0cHhcIiBoZWlnaHQ9XCI2NHB4XCIgYWx0PVwiXCI+Jyk7XG4gICAgJHRleHQuaHRtbCgkaW1nKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZhaWxVcGxvYWRGaWxlIChlcnJvcikge1xuICAgIHZhciBtZXNzYWdlID0gJ+2MjOydvCDsl4XroZzrk5wg7Iuk7YyoLCAnICsgZXJyb3IucmVzcG9uc2VKU09OLm1lc3NhZ2U7XG4gICAgYWxlcnQobWVzc2FnZSk7XG4gIH1cblxuICBpbml0KCk7XG59KTtcbiJdfQ==
